name: 获取公开仓库列表

on:
  workflow_dispatch:  # 手动触发

jobs:
  get-repos:
    runs-on: ubuntu-latest

    steps:
      - name: 获取组织的公开仓库
        run: |
          curl -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
               -H "Accept: application/vnd.github.v3+json" \
               "https://api.github.com/orgs/HITSZ-OpenAuto/repos?type=public" > repos.json

      - name: 解析仓库并保存为环境变量
        id: parse_repos
        run: |
          repos=$(jq -r '.[].name' repos.json | jq -R -s -c 'split("\n")[:-1]')
          echo "repos_array=$repos" >> $GITHUB_ENV

      - name: 使用解析后的仓库数组
        run: |
          # 遍历数组并打印每个值
          for item in $(echo '${{ env.repos_array }}' | jq -r '.[]'); do
            echo "$item" 
          done
